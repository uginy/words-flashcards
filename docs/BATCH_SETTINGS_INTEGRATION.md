# Интеграция настроек батчевой обработки

## Обзор

Реализована полная интеграция настроек батчевой обработки для управления размером пачек слов и задержками между запросами к LLM.

## Внесенные изменения

### 1. Расширение конфигурации (`src/config/llm-settings.ts`)
- Добавлен интерфейс `batching` в `LLMSettings`
- Добавлены ключи localStorage для всех настроек батчинга
- Реализовано полное сохранение и загрузка настроек батчинга

### 2. Обновление hook (`src/hooks/useLLMSettings.ts`)
- Добавлены convenience getters для настроек батчинга:
  - `batchSize` - размер пачки слов
  - `batchDelay` - задержка между запросами
  - `progressiveDelay` - включение прогрессивных задержек
  - `maxDelaySeconds` - максимальная задержка в секундах

### 3. UI для настроек (`src/components/Settings.tsx`)
- Добавлен раздел "Настройки батчевой обработки" в секцию ИИ
- Поля для настройки всех параметров батчинга
- Автоматическое отключение поля максимальной задержки при выключенных прогрессивных задержках

### 4. Интеграция в store (`src/store/wordsStore.ts`)
- Размер чанка теперь берется из `llmSettings.batching.batchSize`
- Добавлены задержки между чанками на основе `llmSettings.batching.batchDelay`
- Реализована поддержка прогрессивных задержек
- Настройки retry используют параметры батчинга

### 5. Обновление скриптов тестирования
- `test-free-models-benchmark.ts` - использует настройки из конфига
- `test-api-chunks.ts` - использует настройки из конфига

## Настройки батчинга

### batchSize (размер пачки)
- **Диапазон**: 1-20 слов
- **По умолчанию**: 5 слов
- **Описание**: Количество слов для обработки за один запрос к LLM

### batchDelay (задержка между запросами)
- **Диапазон**: 0-10000 мс
- **По умолчанию**: 3000 мс (3 секунды)
- **Описание**: Пауза между запросами для предотвращения перегрузки API

### progressiveDelay (прогрессивные задержки)
- **Тип**: boolean
- **По умолчанию**: true
- **Описание**: Увеличивать задержки при повторных запросах (на 10% для каждого последующего чанка)

### maxDelaySeconds (максимальная задержка)
- **Диапазон**: 1-300 секунд
- **По умолчанию**: 30 секунд
- **Описание**: Максимальное время ожидания при прогрессивных задержках

## Использование

### В приложении
1. Перейти в Настройки → ИИ Модель
2. Настроить параметры в разделе "Настройки батчевой обработки"
3. Нажать "Сохранить настройки ИИ"
4. Настройки автоматически применятся при следующей обработке слов

### В скриптах
Скрипты теперь автоматически используют настройки из конфига как значения по умолчанию:

```bash
# Запуск бенчмарка с настройками из конфига
bun run test:free-models-benchmark

# Запуск тестирования чанков с настройками из конфига  
bun run test:api-chunks
```

## Технические детали

### Обратная совместимость
- Все изменения обратно совместимы
- Существующий код продолжает работать
- Добавлены только новые опциональные параметры

### Поток данных
1. Пользователь настраивает параметры в UI
2. Настройки сохраняются в localStorage
3. Hook `useLLMSettings` предоставляет доступ к настройкам
4. Store использует настройки при обработке слов
5. Скрипты читают настройки из конфига

### Валидация
- Все поля имеют валидацию диапазонов
- Максимальная задержка автоматически отключается при выключенных прогрессивных задержках
- Минимальные значения защищают от слишком агрессивных настроек
